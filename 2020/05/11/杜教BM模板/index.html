<div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-05-11T07:00:03.000Z" title="2020-05-11T07:00:03.000Z">2020-05-11</time>发表</span><span class="level-item"><time dateTime="2020-08-15T15:20:26.000Z" title="2020-08-15T15:20:26.000Z">2020-08-15</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/ACM%E6%A8%A1%E6%9D%BF/">ACM模板</a></span><span class="level-item">3 分钟读完 (大约522个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">杜教BM模板</h1><div class="content"><p><strong>用于求线性递推式第n项，扔进前k+x项即可</strong></p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;cstdio&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cstring&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cmath&gt;</span></span><br><span class="line"><span class="comment">#include &lt;algorithm&gt;</span></span><br><span class="line"><span class="comment">#include &lt;vector&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string&gt;</span></span><br><span class="line"><span class="comment">#include &lt;map&gt;</span></span><br><span class="line"><span class="comment">#include &lt;set&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cassert&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line">typedef long long <span class="keyword">ll;</span></span><br><span class="line"><span class="keyword">#define </span>rep(i, a, n) for (int i = a<span class="comment">; i &lt; n; i++)</span></span><br><span class="line"><span class="comment">#define per(i, a, n) for (int i = n - 1; i &gt;= a; i--)</span></span><br><span class="line"><span class="comment">#define pb push_back</span></span><br><span class="line"><span class="comment">#define mp make_pair</span></span><br><span class="line"><span class="comment">#define all(x) (x).begin(), (x).end()</span></span><br><span class="line"><span class="comment">#define fi first</span></span><br><span class="line"><span class="comment">#define se second</span></span><br><span class="line"><span class="comment">#define SZ(x) ((int)(x).size())</span></span><br><span class="line">typedef vector&lt;<span class="keyword">ll&gt; </span>VI;</span><br><span class="line">typedef pair&lt;<span class="keyword">ll, </span><span class="keyword">ll&gt; </span>PII;</span><br><span class="line">const <span class="keyword">ll </span>mod = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">ll </span>powmod(<span class="keyword">ll </span>a, <span class="keyword">ll </span><span class="keyword">b) </span>&#123;</span><br><span class="line">  <span class="keyword">ll </span>res = <span class="number">1</span>;</span><br><span class="line">  a %= mod;</span><br><span class="line">  assert(<span class="keyword">b </span>&gt;= <span class="number">0</span>);</span><br><span class="line">  for (<span class="comment">; b; b &gt;&gt;= 1) &#123;</span></span><br><span class="line">    if (<span class="keyword">b </span>&amp; <span class="number">1</span>) res = res * a % mod;</span><br><span class="line">    a = a * a % mod;</span><br><span class="line">  &#125;</span><br><span class="line">  return res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">ll </span>_, n;</span><br><span class="line">namespace linear_seq &#123;</span><br><span class="line">const <span class="keyword">ll </span>N = <span class="number">10010</span>;</span><br><span class="line"><span class="keyword">ll </span>res[N], <span class="keyword">base[N], </span>_c[N], _md[N];</span><br><span class="line">vector&lt;<span class="keyword">ll&gt; </span>Md;</span><br><span class="line">void <span class="keyword">mul(ll </span>*a, <span class="keyword">ll </span>*<span class="keyword">b, </span>int k) &#123;</span><br><span class="line">  rep(i, <span class="number">0</span>, k + k) _c[i] = <span class="number">0</span>;</span><br><span class="line">  rep(i, <span class="number">0</span>, k) if (a[i]) rep(<span class="keyword">j, </span><span class="number">0</span>, k) _c[i + <span class="keyword">j] </span>=</span><br><span class="line">      (_c[i + <span class="keyword">j] </span>+ a[i] * <span class="keyword">b[j]) </span>% mod;</span><br><span class="line">  for (<span class="keyword">ll </span>i = k + k - <span class="number">1</span><span class="comment">; i &gt;= k; i--)</span></span><br><span class="line">    if (_c[i])</span><br><span class="line">      rep(<span class="keyword">j, </span><span class="number">0</span>, SZ(Md)) _c[i - k + Md[<span class="keyword">j]] </span>=</span><br><span class="line">          (_c[i - k + Md[<span class="keyword">j]] </span>- _c[i] * _md[Md[<span class="keyword">j]]) </span>% mod;</span><br><span class="line">  rep(i, <span class="number">0</span>, k) a[i] = _c[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">ll </span>solve(<span class="keyword">ll </span>n, VI a, VI <span class="keyword">b) </span>&#123;</span><br><span class="line">  <span class="keyword">ll </span>ans = <span class="number">0</span>, pnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">ll </span>k = SZ(a);</span><br><span class="line">  assert(SZ(a) == SZ(<span class="keyword">b));</span></span><br><span class="line"><span class="keyword"> </span> rep(i, <span class="number">0</span>, k) _md[k - <span class="number">1</span> - i] = -a[i];</span><br><span class="line">  _md[k] = <span class="number">1</span>;</span><br><span class="line">  Md.clear();</span><br><span class="line">  rep(i, <span class="number">0</span>, k) if (_md[i] != <span class="number">0</span>) Md.push_back(i);</span><br><span class="line">  rep(i, <span class="number">0</span>, k) res[i] = <span class="keyword">base[i] </span>= <span class="number">0</span>;</span><br><span class="line">  res[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  while ((<span class="number">1</span>ll &lt;&lt; pnt) &lt;= n) pnt++;</span><br><span class="line">  for (<span class="keyword">ll </span>p = pnt<span class="comment">; p &gt;= 0; p--) &#123;</span></span><br><span class="line">    <span class="keyword">mul(res, </span>res, k);</span><br><span class="line">    if ((n &gt;&gt; p) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">      for (<span class="keyword">ll </span>i = k - <span class="number">1</span><span class="comment">; i &gt;= 0; i--) res[i + 1] = res[i];</span></span><br><span class="line">      res[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      rep(<span class="keyword">j, </span><span class="number">0</span>, SZ(Md)) res[Md[<span class="keyword">j]] </span>= (res[Md[<span class="keyword">j]] </span>- res[k] * _md[Md[<span class="keyword">j]]) </span>% mod;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  rep(i, <span class="number">0</span>, k) ans = (ans + res[i] * <span class="keyword">b[i]) </span>% mod;</span><br><span class="line">  if (ans &lt; <span class="number">0</span>) ans += mod;</span><br><span class="line">  return ans;</span><br><span class="line">&#125;</span><br><span class="line">VI <span class="keyword">BM(VI </span>s) &#123;</span><br><span class="line">  VI C(<span class="number">1</span>, <span class="number">1</span>), <span class="keyword">B(1, </span><span class="number">1</span>);</span><br><span class="line">  <span class="keyword">ll </span>L = <span class="number">0</span>, m = <span class="number">1</span>, <span class="keyword">b </span>= <span class="number">1</span>;</span><br><span class="line">  rep(n, <span class="number">0</span>, SZ(s)) &#123;</span><br><span class="line">    <span class="keyword">ll </span>d = <span class="number">0</span>;</span><br><span class="line">    rep(i, <span class="number">0</span>, L + <span class="number">1</span>) d = (d + (<span class="keyword">ll)C[i] </span>* s[n - i]) % mod;</span><br><span class="line">    if (d == <span class="number">0</span>)</span><br><span class="line">      ++m;</span><br><span class="line">    else if (<span class="number">2</span> * L &lt;= n) &#123;</span><br><span class="line">      VI T = C;</span><br><span class="line">      <span class="keyword">ll </span>c = mod - d * powmod(<span class="keyword">b, </span>mod - <span class="number">2</span>) % mod;</span><br><span class="line">      while (SZ(C) &lt; SZ(<span class="keyword">B) </span>+ m) C.pb(<span class="number">0</span>);</span><br><span class="line">      rep(i, <span class="number">0</span>, SZ(<span class="keyword">B)) </span>C[i + m] = (C[i + m] + c * <span class="keyword">B[i]) </span>% mod;</span><br><span class="line">      L = n + <span class="number">1</span> - L;</span><br><span class="line">      <span class="keyword">B </span>= T;</span><br><span class="line">      <span class="keyword">b </span>= d;</span><br><span class="line">      m = <span class="number">1</span>;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      <span class="keyword">ll </span>c = mod - d * powmod(<span class="keyword">b, </span>mod - <span class="number">2</span>) % mod;</span><br><span class="line">      while (SZ(C) &lt; SZ(<span class="keyword">B) </span>+ m) C.pb(<span class="number">0</span>);</span><br><span class="line">      rep(i, <span class="number">0</span>, SZ(<span class="keyword">B)) </span>C[i + m] = (C[i + m] + c * <span class="keyword">B[i]) </span>% mod;</span><br><span class="line">      ++m;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return C;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">ll </span>gao(VI a, <span class="keyword">ll </span>n) &#123;</span><br><span class="line">  VI c = <span class="keyword">BM(a);</span></span><br><span class="line"><span class="keyword"> </span> c.erase(c.<span class="keyword">begin());</span></span><br><span class="line"><span class="keyword"> </span> rep(i, <span class="number">0</span>, SZ(c)) c[i] = (mod - c[i]) % mod;</span><br><span class="line">  return solve(n, c, VI(a.<span class="keyword">begin(), </span>a.<span class="keyword">begin() </span>+ SZ(c)));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="comment">;  // namespace linear_seq</span></span><br><span class="line">int main() &#123;</span><br><span class="line">  while (~<span class="keyword">scanf(&quot;%lld&quot;, </span>&amp;n) &amp;&amp; n != -<span class="number">1</span>) &#123;</span><br><span class="line">    vector&lt;<span class="keyword">ll&gt;v;</span></span><br><span class="line"><span class="keyword"> </span>      v.push_back(<span class="number">0</span>);</span><br><span class="line">       v.push_back(<span class="number">1</span>);</span><br><span class="line">        v.push_back(<span class="number">1</span>);</span><br><span class="line">        v.push_back(<span class="number">2</span>);</span><br><span class="line">        v.push_back(<span class="number">3</span>);</span><br><span class="line">        v.push_back(<span class="number">5</span>);</span><br><span class="line">        v.push_back(<span class="number">8</span>);</span><br><span class="line">        v.push_back(<span class="number">13</span>);</span><br><span class="line">        v.push_back(<span class="number">21</span>);</span><br><span class="line">        v.push_back(<span class="number">34</span>);</span><br><span class="line">      printf(<span class="string">&quot;%lld\n&quot;</span>, linear_seq::gao(v, n));</span><br><span class="line">  &#125;</span><br><span class="line">  return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>杜教BM模板</p><p><a href="http://yoursite.com/2020/05/11/%E6%9D%9C%E6%95%99BM%E6%A8%A1%E6%9D%BF/">http://yoursite.com/2020/05/11/%E6%9D%9C%E6%95%99BM%E6%A8%A1%E6%9D%BF/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Benboby</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-05-11</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-08-15</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%95%B0%E5%AD%A6/">数学</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/05/11/%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%EF%BC%8C%E6%8B%B7%E8%B4%9D%E5%A4%8D%E5%88%B6%EF%BC%8C%E6%9E%90%E6%9E%84/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">拷贝构造，拷贝复制，析构</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/05/10/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%9A%E7%9A%87%E5%AE%B6%E7%83%88%E7%84%B0%EF%BC%88%E7%BA%BF%E6%80%A7dp%EF%BC%89/"><span class="level-item">每日一题：皇家烈焰（线性dp）</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->